{% extends 'base.html' %}
{% block content %}

<h1> Google Map</h1>
<style>
    #map {
        height:400px;
        width:100%;
    }
</style>
<div id="map"></div>

<script>
    {% autoescape off %}
    var sightings_list = {{ sightings }}
    {% endautoescape %}
</script>

<script>
    function initMap(){
        // Map options
        var options = {
            zoom:8,
            center:{lat:34.0522,lng:-118.2437}
        };
        
        // New map
        var map = new google.maps.Map(document.getElementById('map'), options);

        console.log(sightings_list)

        // Listen for click on map
        // google.maps.event.addListener(map, 'click',
        // function(event){
        //     // Add marker
        //     addMarker({coords: event.latLng});
        //     console.log(event.latLng.toString())
        // });

        // Loop through sightings and make markers
        for(var i=0; i < sightings_list.length; i++){
            addMarker(sightings_list[i]);
        }

        // Add Marker Function
        function addMarker(props){
            var x = parseFloat(props.lat)
            var y = parseFloat(props.lng)
            var marker = new google.maps.Marker({
            position: { lat: x, lng: y },
            map: map,
            // icon: props.iconImage
        });

        // Check content
        if(props.title){
            var cStr = '<h4>' + String(props.title) + '<h4>'
            var infoWindow = new google.maps.InfoWindow({
            content: cStr
        });

        marker.addListener('click', function(){
            infoWindow.open(map, marker);
        });
        }
        }
    }
</script>
<script defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBvpsQ28JANinTPRU3S-Zw3b8eBkLlIGmU&callback=initMap">
</script>

{% endblock %}